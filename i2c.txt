1,i2c的驱动架构有几层？？？
i2c有3层要掌握，i2c核心层，i2c总线驱动，i2c设备驱动

i2c核心层:管理总线驱动和设备驱动


i2c总线驱动：针对不同的I2C控制器做区分


i2c设备驱动：操作不同的外设



2,在linux中，I2C的分为几层？？？每一层都有哪些东西？？？

3层,分别是应用层序，I2C内核，硬件。

其中，内核部分就是驱动部分，硬件分为I2C控制器和I2C外设。

在Linux中，I2C控制器属于硬件。
实际上，在STM32中，I2C的控制器也是属于硬件。

I2C外设在Linux中属于硬件
实际上，在STM32中，I2C外设也是属于硬件。


3，总线驱动端，不同的I2C总线驱的区别是 什么？？？具体的代码在哪里？？？

总线端，I2C1,I2C2,I2C3 就是不同的总线。不同的总线对应着不同的控制器。



4，I2C的驱动程序应该怎么学习？？？
一半冷一半热  15:44:55
驱动工程师搞的是设备

一半冷一半热  15:45:02
只是框架里面的一小块

一半冷一半热  15:45:18
主机驱动是不需要深入了解

5，我目前的疑问是什么？？？
和STM32相比较，STM32的SPI是主机和外设都要初始化一遍，STM32的I2C是直接配置的，在软件上，并没有初始化2次，而是直接初始化一次，那么

像uart和IIC 都是只初始化了一次，那么Linux是怎么区分的总线驱动和设备驱动？？？ 总线驱动做了什么，总线驱动和设备驱动是怎么衔接的？？？





6，I2C总线驱动和设备驱动的区别？？？
总线  /driver/i2c/busses/ 目录下有各种i2c的总线驱动。
设备  /driver/rtc/pvf8568.c

当看到这里的时候，到底总线驱动和设备驱动的区别是什么呢？？？？

7，IIC总线驱动应该怎么改？？？
总线驱动端，只需要对应上IIC要操作的器件的引脚。

即总线能对上引脚的号就行了。

7，总线端的代码做了什么？？？他和设备驱动端的代码做的事情的区别？？？

注册设备驱动，也可以注销。向总线注册  I2C设备信息。
实现设备和总线的适配。

6，我应该怎么改了，是自己重新添加一个文件，还是改现有的文件中的代码？？？

总线直接改，设备驱动端要自己写。

8，
加目录

Kconfig

makefile


9，设备驱动该怎么写？？？



10，i2c 调试思路
1，全职科技的sys_config等价于设备树，那么设备树就不需要改动

2，设备驱动怎么写？？？直接点说设备驱动给总线驱动调用的是哪个接口？？？

11，了解了接口的调用关系，然后直接把驱动移植过来，

直接把接口调用内容改动就可以了。直接改动Kconfig ,Makefile 即可。 先重点把思路捋清除了，剩下的都是小事。


20200708
加目录

Kconfig

makefile

pcf8591---adc---i2c
pcf8563---rtc---i2c



了解到设备驱动做了什么后，我下一步又要做什么？？？

做什么，是个架构的问题，剩下的是具体的参数怎么个配置的问题

1，全职科技的sys_config等价于设备树，那么设备树就不需要改动

2，设备驱动怎么写？？？直接点说设备驱动给总线驱动调用的是哪个接口？？？



1，要用系统总线来实现设备的读写，函数是 i2c_smbus_write_byte_data()

2，总线驱动和设备树的关系是什么？？？
subsys_initcall(sunxi_i2c_adap_init);
module_exit(sunxi_i2c_adap_exit);
最后调用的是这2个接口，I2C总线驱动端

设备驱动主要是下面这个接口
module_i2c_driver(pcf8563_driver);


3，内核的驱动和以前的STM32有很大的区别，
Linux的内核是编译成.ko 的形式，STM32是编译成.o的形式，然后连接。


4，思路现在断了，不知道I2C的设备驱动该写成什么样子？？？、

5，当下要解决的疑问是什么？？？
是驱动函数的调用关系，我不知道是谁调用了这个函数


6，linux下的驱动的.c文件中对外的接口没有被调用，那么驱动是怎么生成的？？？

一半冷一半热  15:34:39
生成.o 这是驱动用起来了

一半冷一半热  15:34:53
现在都是设备驱动分离啊

一半冷一半热  15:35:07
设备端没配置  驱动不起作用


总线驱动和设备驱动分别做了什么事情？？？


要改的是什么，是关系和接口，因为不需要写，该写的都写好了，剩下的就是确定软件架构，然后
把API的调用写好。


7，看一下厂家提供的代码是怎么调用的，然后，看全志科技是怎么调用的。

总线驱动应该是不用改动的吧

8，能不能直接把加密芯片的IIC驱动一直到全职科技的板子上？？？
不能，因为直接提供的开发资料中，有专门的IIC的接口用于操作总线IIC和设备IIC.

9,   improve efficiency  18:09:24
 i2c_add_driver() 是注册一个I2C设备驱动
 i2c_register_board_info() 是向某个 I2C 总线注册 I2C 设备信息，

improve efficiency  18:09:33
这2有啥区别

improve efficiency  18:09:40
这俩有啥区别

一半冷一半热撤回了一条消息

一半冷一半热  18:09:56
一个是设备

一半冷一半热  18:10:01
一个是驱动

improve efficiency  18:10:31
哦哦
 i2c_add_driver() 是注册一个I2C驱动
i2c_register_board_info() 是向某个 I2C 总线注册 设备

一半冷一半热 2020/7/8 18:10:41
是
10，注册的时候，是设备端调总线驱动注册的接口，还是总线端调用设备驱动的接口？？？

在设备端，要注册2次，要对外开放的初始化函数中，既要 i2c_add_driver()，
也要 i2c_register_board_info() 。


12，总体的思路没有好，首先设备驱动的写法还没好，其次，写好设备驱动后，
Kconfig和Makefile，这2个事情。

13，还剩下最后一个问题，










